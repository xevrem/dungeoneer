{"version":3,"sources":["registerServiceWorker.js","index.js"],"names":["isLocalhost","Boolean","window","location","hostname","match","registerValidSW","swUrl","navigator","serviceWorker","register","then","registration","onupdatefound","installingWorker","installing","onstatechange","state","controller","console","log","catch","error","glyphs","game","this","display","container","w","h","map","free","entities","Console","console_display","cw","ch","floor","r","final_floor","game_over","ROT","width","height","fontFamily","fontSize","forceSquareRatio","init","scheduler","Simple","engine","fov","PreciseShadowcasting","handle_lightpass","bind","display_canvas","getContainer","id","console_canvas","document","getElementById","appendChild","Uniform","roomWidth","roomHeight","roomDugPercentage","create","handle_map","current","cleanup","generate_map","get_safe_location","x","y","player","push","add","i","Entity","dynamic_goblin","Templates","HealingPotion","Weapon","Armor","dynamic_stairs_down","GoblinKing","e","has_component","remove","splice","length","v","tile","glyph","is_walkable","is_light_passible","uncovered","Math","random","ignore","name","entity","j","Player","message","add_message","clear","drawText","creature_name","msg","cb","after_render","get_tile","draw","get_entity_at","compute","handle_fov_compute","render","create_message","text","fg_color","bg_color","fg","bg","send_message","size","buffer","buffer_size","cursor","index","Components","Moveable","try_move","attack","Actor","target","act","is_entity_adjacent","dx","dy","race","PlayerActor","lock","Attacker","template","defense_value","attack_value","dmg","take_damage","Destructable","max_hp","hp","attacker","damage","remove_self","award","win_game","lose_game","Usable","charges","eternal","use","user","heal","upgrade","change_floor","Healing","healing_power","new_hp","Upgrading","upgrades","Leveling","level","xp","starting_xp","next_lvl","ChangesFloor","next_floor","create_new_floor","WinOnDefeat","LoseOnDefeat","components","Goblin","apply_template","key","add_components","hasOwnProperty","call","component","remove_entity","PlayerInfo","props","lvl","atk","def","flr","className","App","handle_render","after_render_callback","handle_input","addEventListener","create_player","start","event","preventDefault","clear_buffer","move","use_at_location","look","unlock","setState","href","aria-hidden","React","Component","ReactDOM","URL","process","origin","fetch","response","status","headers","get","indexOf","ready","unregister","reload","checkValidServiceWorker","registerServiceWorker"],"mappings":"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","file":"static/js/main.c5c9b3ad.chunk.js","sourcesContent":["// In production, we register a service worker to serve assets from local cache.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on the \"N+1\" visit to a page, since previously\n// cached resources are updated in the background.\n\n// To learn more about the benefits of this model, read https://goo.gl/KwvDNy.\n// This link also includes instructions on opting out of this behavior.\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport default function register() {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebookincubator/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (!isLocalhost) {\n        // Is not local host. Just register service worker\n        registerValidSW(swUrl);\n      } else {\n        // This is running on localhost. Lets check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the old content will have been purged and\n              // the fresh content will have been added to the cache.\n              // It's the perfect time to display a \"New content is\n              // available; please refresh.\" message in your web app.\n              console.log('New content is available; please refresh.');\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      if (\n        response.status === 404 ||\n        response.headers.get('content-type').indexOf('javascript') === -1\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\n\nimport './index.css';\n//import {createStore} from 'redux'\nimport registerServiceWorker from './registerServiceWorker';\nimport * as ROT from 'rot-js';\n\nvar glyphs = {\n  //wall\n  'WALL':['#','#653','#320'],\n  //floor\n  'FLOOR':['.','#aaa','#333'],\n  //player\n  'PLAYER':['@','#ddd','#333'],\n  //Goblin\n  'GOBLIN':['g','#5f5','#333'],\n  //Goblin King\n  'GOBLIN_KING':['G','#5f5','#333'],\n  //Potion\n  'HEALING_POTION':['!','#88f','#333'],\n  //Armor\n  'ARMOR':['a','#ff8','#333'],\n  //Weapon\n  'WEAPON':['w','#875','#333'],\n  //Stairs down\n  'STAIRS_DOWN':['v','#ddd','#333'],\n};\n\n\n\n/*\n* GAME CLASS\n*/\n\nclass Game {\n  constructor(){\n    this.display = null;\n    this.container = null;\n    this.w =  50;\n    this.h = 30;\n    this.map = [];\n    this.free = [];\n    this.entities = [];\n    this.Console = null;\n    this.console_display = null;\n    this.cw = 50;\n    this.ch = 5;\n    this.floor = 1;\n    this.r = 10;\n    this.final_floor=5;\n    this.game_over = false;\n  }\n\n  init(){\n    this.display = new ROT.Display({\n      width:this.w,\n      height:this.h,\n      fontFamily: 'Ubuntu Mono',\n      fontSize:15,\n      forceSquareRatio: true\n    });\n\n    this.console_display = new ROT.Display({\n      width: this.cw,\n      height: this.ch,\n      fontFamily: 'Ubuntu Mono',\n      fontSize: 15,\n      forceSquareRatio: true,\n    });\n\n    this.Console = new Console(this.console_display, this.ch);\n    this.Console.init();\n\n    this.scheduler = new ROT.Scheduler.Simple();\n    this.engine = new ROT.Engine(this.scheduler);\n\n    this.fov = new ROT.FOV.PreciseShadowcasting(this.handle_lightpass.bind(this));\n\n    this.display_canvas = this.display.getContainer();\n    this.display_canvas.id = 'display-canvas';\n\n    this.console_canvas = this.console_display.getContainer();\n    this.console_canvas.id = 'console-canvas'\n\n    document.getElementById('displays').appendChild(this.display_canvas);\n    document.getElementById('displays').appendChild(this.console_canvas);\n  }\n\n  generate_map(){\n\n    var newmap = new ROT.Map.Uniform(this.w, this.h,{\n      roomWidth:[3,10],\n      roomHeight:[3,10],\n      roomDugPercentage: 0.3,\n    });\n    newmap.create(this.handle_map.bind(this));\n  }\n\n  create_new_floor(current=0){\n    this.cleanup();\n\n    this.floor = current;\n\n    this.generate_map();\n\n    //remake the engine and scheduler\n    //this.scheduler = new ROT.Scheduler.Simple();\n    ///this.engine = new ROT.Engine(this.scheduler);\n\n    var [x,y] = this.get_safe_location();\n    this.player.x = x;\n    this.player.y = y;\n    this.entities.push(this.player);\n    this.scheduler.add(this.player, true);\n\n    for(var i = 0; i<10; i++){\n      [x,y] = this.get_safe_location();\n      new Entity(x,y,'Goblin', dynamic_goblin(this.floor));\n    }\n\n    for(var i = 0; i < 3; i++){\n      [x,y] = this.get_safe_location();\n      new Entity(x,y,'Potion', Templates.HealingPotion);\n    }\n\n    [x,y] = this.get_safe_location();\n    new Entity(x,y, 'Weapon', Templates.Weapon);\n\n    [x,y] = this.get_safe_location();\n    new Entity(x,y, 'Armor', Templates.Armor);\n\n    if(this.floor !== this.final_floor){\n      [x,y] = this.get_safe_location();\n      new Entity(x,y, 'Stairs', dynamic_stairs_down());\n    }\n\n    //spawn goblin king\n    if(this.floor === this.final_floor){\n      [x,y] = this.get_safe_location();\n      new Entity(x,y,'Goblin King', Templates.GoblinKing);\n    }\n\n  }\n\n  cleanup(){\n    for(var e of this.entities){\n      if(e.has_component('Actor') || e.has_component('PlayerActor'))\n        game.scheduler.remove(e);\n    }\n    this.entities.splice(0,this.entities.length);\n    this.free.splice(0,this.free.length);\n    this.map.splice(0,this.map.length);\n  }\n\n  handle_map(x,y,v){\n    //set tile key\n    var tile = {\n      glyph: v ? 'WALL': 'FLOOR',\n      is_walkable: v ? false : true,\n      is_light_passible: v ? false : true,\n      uncovered: false,\n      entities:[],\n    };\n    //store free cells\n    if(!v) this.free.push([x, y, x*this.h+y]);\n    //push a new tile onto map, allows multiple objects per coord\n    this.map.push(tile);\n  }\n\n  get_safe_location(){\n    return this.free[Math.floor(Math.random() * this.free.length)];\n  }\n\n  get_tile(x, y){\n    if(x >= 0 && x < this.w && y>=0 && y < this.h)\n      return this.map[x*this.h+y];\n    return null;\n  }\n\n  //get entity at location and ignore any specific name passed\n  get_entity_at(x,y, ignore=''){\n    if(x >= 0 && x < this.w && y>=0 && y < this.h){\n      for(var e of this.entities){\n        if(e.x === x && e.y === y){\n          if(e.name !== ignore)\n            return e;\n        }\n      }\n    }\n  }\n\n  is_entity_adjacent(x,y, entity){\n    for(var i = -1; i<2; i++){\n      for(var j = -1; j<2; j++){\n        //dont look for yourself\n        if(i === 0 && j === 0) continue;\n\n        if((x+i === entity.x) && (y+j === entity.y)){\n          return true;\n        }\n      }\n    }\n    return false;\n  }\n\n  create_player(){\n    var [x,y] = this.get_safe_location();\n    this.player = new Entity(x, y, 'Player', Templates.Player);\n  }\n\n  remove_entity(entity){\n    for(var i in this.entities){\n      if(entity === this.entities[i])\n        this.entities.splice(i,1);\n    }\n  }\n\n  send_message(message){\n    this.Console.add_message(message);\n  }\n\n  win_game(){\n    this.game_over = true;\n    this.cleanup();\n    this.display.clear();\n\n    this.display.drawText(16,12,'%c{gold}Congratulations!!!');\n    this.display.drawText(8,13,'%c{gold}You Have Defeated The %c{#8f8}Goblin King%c{gold}!');\n    this.display.drawText(11,15,'To Play Again, Press [ENTER]');\n  }\n\n  lose_game(creature_name){\n    this.game_over = true;\n    this.cleanup();\n    this.display.clear();\n\n    this.display.drawText(20,12,'%c{red}You Died!!!');\n    var msg = 'The '+creature_name+' Defeated You.';\n    this.display.drawText(Math.floor(this.w/2) - Math.floor(msg.length/2), 13, msg);\n    this.display.drawText(11,15,'To Play Again, Press [ENTER]');\n  }\n\n  after_render_callback(cb){\n    this.after_render = cb;\n  }\n\n  //return the light passed attribute for the given tile\n  handle_lightpass(x, y){\n    var tile = this.get_tile(x,y);\n    return tile ? tile.is_light_passible : false;\n  }\n\n  handle_fov_compute(x,y,r,v){\n    this.display.draw(x,y, ...glyphs[this.map[x*this.h+y].glyph]);\n    //see if there are any visible entities, ignoring player\n    var entity = this.get_entity_at(x,y,'Player');\n    if(entity){\n      // console.log(entity);\n      this.display.draw(entity.x, entity.y, ...glyphs[entity.glyph]);\n    }\n  }\n\n  render(){\n    this.display.clear();\n\n    //compute and draw the field of view at the player's position\n    this.fov.compute(this.player.x, this.player.y, this.r, this.handle_fov_compute.bind(this));\n\n    //ensure player drawn over top\n    this.display.draw(this.player.x, this.player.y, ...glyphs[this.player.glyph]);\n\n    //draw console\n    this.Console.render();\n\n    //issue_callback\n    this.after_render();\n  }\n\n  render_old(){\n    this.display.clear();\n\n    //draw base map\n    for(var x = 0; x < this.w; x++){\n      for(var y = 0; y < this.h; y++){\n        this.display.draw(x,y, ...glyphs[this.map[x*this.h+y].glyph]);\n      }\n    }\n\n    //draw entities\n    for(var e of this.entities){\n      this.display.draw(e.x, e.y, ...glyphs[e.glyph]);\n    }\n\n    //ensure player drawn over top\n    this.display.draw(this.player.x, this.player.y, ...glyphs[this.player.glyph]);\n\n    //draw console\n    this.Console.render();\n\n    //issue_callback\n    this.after_render();\n  }\n}\n\nvar game = new Game();\n\n\n/*\n* CONSOLE\n*/\n\n//message creation helper\nfunction create_message (text, fg_color, bg_color){\n  var msg = {\n    text: text,\n    fg: fg_color || '#fff',\n    bg: bg_color || '#000',\n  };\n  game.send_message(msg);\n}\n\nclass Console{\n  constructor(display, size){\n    this.display = display;\n    this.buffer = [];\n    this.buffer_size = size;\n    this.cursor = 0;\n  }\n\n  init(){\n    create_message('Welcome to Dungeoneer: The Roguelike!');\n    create_message('Move: [W,A,S,D], Use: [U], Look: [L]');\n    create_message('Defeat the Goblin King on floor '+game.final_floor+' to win.');\n    create_message('You fall through the ground and find yourself','#88f','#000');\n    create_message('in a dungeon. There are goblins nearby...','#88f','#000');\n  }\n\n  clear_buffer(){\n    this.buffer = [];\n    this.cursor = 0;\n    for(var i = 0; i < this.buffer_size-4; i++){\n      this.buffer.push({text:'', fg:'', bg:''});\n    }\n    this.display.clear();\n  }\n\n  add_message(message){\n    this.buffer[this.cursor%this.buffer_size] = message;\n    this.cursor += 1;\n  }\n\n  render(){\n    this.display.clear();\n    for(var i = 0; i < this.buffer_size; i++){\n      var index = (this.cursor + i) % this.buffer_size;\n      this.display.drawText(0,i,'%c{'+this.buffer[index].fg+'}%b{'+this.buffer[index].bg+'}'+this.buffer[index].text);\n    }\n  }\n}\n\n\n/*\n* COMPONENTS\n*/\nvar Components={};\nComponents.Moveable = {\n  name: 'Moveable',\n  try_move: function(x, y){\n    //console.log('try_move...', this);\n    //get this tile\n    var tile = game.get_tile(x, y);\n    var entity = game.get_entity_at(x, y);\n    //console.log(entity,tile);\n    if(entity){\n      if(this.has_component('Attacker') && entity.has_component('Destructable')){\n        this.attack(entity);\n        return;\n      }\n    }\n\n    if(tile.is_walkable){\n      this.x = x;\n      this.y = y;\n    }\n\n  },\n};\n\n\nComponents.Actor = {\n  name: 'Actor',\n  init: function() {\n    this.target = null;\n  },\n  act: function(){\n\n    //attack a target if possible\n    if(this.target){\n      //console.log('have target',this.target);\n      if(game.is_entity_adjacent(this.x, this.y, this.target)){\n        //console.log('is nearby...')\n        this.attack(this.target);\n        return;\n      }\n    }\n\n    var dx = Math.floor(Math.random() * 3 - 1);\n    var dy = Math.floor(Math.random() * 3 - 1);\n\n    //dont do anything\n    if(dx === 0 && dy === 0)\n      return;\n\n    var x = this.x + dx;\n    var y = this.y + dy;\n\n    var tile = game.get_tile(x,y);\n    var entity = game.get_entity_at(x,y);\n\n    if(entity){\n      if(this.has_component('Attacker') && entity.has_component('Destructable')){\n        if(this.race === entity.race)\n          return;\n        this.target = entity;\n        this.attack(entity);\n        return;\n      }\n    }\n\n    if(tile.is_walkable){\n      this.x = x;\n      this.y = y;\n      return;\n    }\n  }\n};\n\nComponents.PlayerActor = {\n  name:'PlayerActor',\n  init: function() {},\n  act: function(){\n    //issue redraw\n    game.render();\n\n    //lock the engine - will be released after player moves\n    game.engine.lock();\n  }\n};\n\nComponents.Attacker={\n  name:'Attacker',\n  init: function(template) {\n    this.defense_value = template.defense_value || 0;\n    this.attack_value = template.attack_value || 1;\n  },\n  attack: function(target){\n    if(target.has_component('Destructable')){\n      //console.log(this.name,'attacks',target.name);\n      var dmg = Math.floor(Math.random()*(1+this.attack_value - target.defense_value));\n\n      if(dmg === 0){\n        create_message(this.name+' misses '+target.name,'#ff8','#000');\n      }\n\n      var msg = this.name + ' attacks ' + target.name + ' for ' + dmg + ' damage.';\n      create_message(msg, '#f80','#000');\n      target.take_damage(this, dmg);\n    }\n  }\n};\n\nComponents.Destructable ={\n  name:'Destructable',\n  init: function(template) {\n    this.max_hp = template.max_hp || 10;\n    this.hp = template.hp || this.max_hp;\n  },\n  take_damage(attacker, damage){\n    this.hp -= damage;\n\n    //if you've been attacked set your target\n    if(this.has_component('Actor')) this.target = attacker;\n\n    if(this.hp <= 0){\n      //console.log(attacker.name,'killed',this.name);\n      create_message(attacker.name + ' kills ' + this.name+'.', '#f55','#000');\n      this.remove_self();\n\n      if(attacker.has_component('Leveling')){\n        //award xp based on dungeon floor\n        attacker.award(game.floor);\n      }\n\n      if(this.has_component('WinOnDefeat')){\n        this.win_game();\n      }\n\n      if(this.has_component('LoseOnDefeat')){\n        this.lose_game(attacker);\n      }\n    }\n  }\n};\n\nComponents.Usable = {\n  name: 'Usable',\n  init: function(template){\n    this.charges = template.charges || 1;\n    this.eternal = template.eternal || false;\n  },\n  use: function(user){\n    //if healing potion\n    if(this.has_component('Healing')){\n      create_message(user.name+' uses '+this.name+'.','#88f','#000');\n      this.heal(user);\n    }\n\n    //if upgrade\n    if(this.has_component('Upgrading')){\n      create_message(user.name+' picks up a '+this.name+'.','#ddd','#000');\n      this.upgrade(user);\n    }\n\n    //if changes floor\n    if(this.has_component('ChangesFloor')){\n      create_message(user.name+' uses '+this.name+'.', '#ddd','#000');\n      this.change_floor(user);\n    }\n\n    //if lower the charges and remove if appropriate\n    if(--this.charges <= 0){\n      //remove if not eternal\n      if(!this.eternal)\n        this.remove_self();\n    }\n  }\n};\n\nComponents.Healing = {\n  name: 'Healing',\n  init: function(template){\n    this.healing_power = template.healing_power || 5;\n  },\n  heal: function(entity){\n    create_message(entity.name+' gains '+this.healing_power+' hp from '+this.name+'.','#8f8','#000');\n    var new_hp = entity.hp + this.healing_power;\n    entity.hp =  new_hp > entity.max_hp ? entity.max_hp : new_hp;\n  }\n};\n\nComponents.Upgrading = {\n  name: 'Upgrading',\n  init: function(template){\n    this.upgrades = template.upgrades || {'HP':1};\n  },\n  upgrade: function(entity){\n    for(var upgrade in this.upgrades){\n      switch(upgrade){\n      case 'HP':\n        entity.max_hp += this.upgrades['HP'];\n        break;\n      case 'ATK':\n        entity.attack_value += this.upgrades['ATK'];\n        break;\n      case 'DEF':\n        entity.defense_value += this.upgrades['DEF'];\n        break;\n      default:\n        break;\n      }\n      create_message(entity.name+' gains '+this.upgrades[upgrade]+' '+upgrade+'.','#f8f','#000');\n    }\n  }\n};\n\nComponents.Leveling = {\n  name: 'Leveling',\n  init: function(template){\n    this.level = template.level || 1;\n    this.xp = template.starting_xp || 0;\n    this.next_lvl = template.next_lvl || 5;\n  },\n  award: function(xp){\n    this.xp += xp;\n    create_message(this.name+' gains experience.','#88f','#000');\n    if(this.xp >= this.next_lvl){\n      this.level += 1;\n      this.attack_value += 1;\n      this.max_hp += 5;\n      this.hp = this.max_hp;\n      this.next_lvl *= 2;\n      create_message(this.name+' levels up.','#f8f','#000');\n    }\n  }\n};\n\nComponents.ChangesFloor = {\n  name: 'ChangesFloor',\n  init:function(template){\n    this.next_floor = template.next_floor || 2;\n  },\n  change_floor:function(entity){\n    create_message(entity.name+' decends deeper into the dungeon.','#ddd','#000');\n    game.create_new_floor(game.floor+1);\n  }\n};\n\nComponents.WinOnDefeat = {\n  name: 'WinOnDefeat',\n  win_game:function(){\n    create_message('You Have Won!', 'gold', '#000');\n    game.Console.render();\n    game.win_game();\n  }\n};\n\nComponents.LoseOnDefeat = {\n  name: 'LoseOnDefeat',\n  lose_game:function(entity){\n    create_message('You Have Lost!', 'red', '#000');\n    game.Console.render();\n    game.lose_game(entity.name);\n  }\n};\n\n/*\n* STATIC TEMPLATES\n*/\nvar Templates = {};\n\nTemplates.Player = {\n  glyph: 'PLAYER',\n  race: 'HUMAN',\n  max_hp: 10,\n  attack_value: 2,\n  defense_value: 0,\n  components: [Components.Moveable, Components.PlayerActor, Components.Attacker, Components.Destructable, Components.Leveling, Components.LoseOnDefeat]\n};\n\nTemplates.Goblin = {\n  glyph: 'GOBLIN',\n  race: 'GOBLIN',\n  max_hp: 3,\n  attack_value: 2,\n  defense_value: 0,\n  components: [Components.Moveable, Components.Actor, Components.Attacker, Components.Destructable]\n};\n\nTemplates.HealingPotion = {\n  glyph: 'HEALING_POTION',\n  healing_power: 5,\n  charges: 1,\n  components: [Components.Usable, Components.Healing]\n};\n\nTemplates.Weapon = {\n  glyph: 'WEAPON',\n  charges: 1,\n  upgrades:{\n    'ATK':1,\n  },\n  components:[Components.Usable, Components.Upgrading]\n};\n\nTemplates.Armor = {\n  glyph: 'ARMOR',\n  charges: 1,\n  upgrades:{\n    'DEF':1,\n  },\n  components:[Components.Usable, Components.Upgrading]\n};\n\nTemplates.GoblinKing ={\n  glyph: 'GOBLIN_KING',\n  race: 'GOBLIN',\n  max_hp: 40,\n  attack_value: 10,\n  defense_value: 5,\n  components: [Components.Moveable, Components.Actor, Components.Attacker, Components.Destructable, Components.WinOnDefeat]\n};\n\n/*\n* DYNAMIC TEMPLATES\n*/\n\nconst dynamic_goblin = floor =>{\n  return {\n    glyph: 'GOBLIN',\n    race: 'GOBLIN',\n    max_hp: 5 + 2 * floor,\n    attack_value: 1 + floor,\n    defense_value: floor - 1,\n    components: [Components.Moveable, Components.Actor, Components.Attacker, Components.Destructable]\n  };\n};\n\nconst dynamic_stairs_down = floor =>{\n  return {\n    glyph: 'STAIRS_DOWN',\n    next_floor: floor+1,\n    eternal: true,\n    components: [Components.Usable, Components.ChangesFloor]\n  };\n};\n\n/*\n* ENTITIES\n*/\n\nclass Entity {\n  constructor(x, y, name, template){\n    this.x = x;\n    this.y = y;\n    this.name = name;\n\n    this.apply_template(template);\n\n    //add to game\n    game.entities.push(this);\n\n    //add to engine\n    if(this.has_component('Actor') || this.has_component('PlayerActor'))\n      game.scheduler.add(this, true);\n  }\n\n  //applies template\n  apply_template(template){\n    for(var key in template){\n      //console.log(key, template[key]);\n      //check to see if this is a component\n      if(key === 'components'){\n        this.add_components(template[key], template);\n      }\n      this[key] = template[key];\n    }\n    return template;\n  }\n\n  //adds component mixins\n  add_components(components, template){\n    for(var i in components){\n      for(var key in components[i]){\n        //don't copy ovesr component name, init method, or overwrite anything\n        if(key !== 'init' && key !== 'name' && !this.hasOwnProperty(key)){\n          this[key] = components[i][key];\n        }\n      }\n\n      //call component's init method\n      if(components[i].init)\n        components[i].init.call(this, template);\n    }\n  }\n\n  has_component(component){\n    for(var c of this.components){\n      if(c.name === component){\n        return true;\n      }\n    }\n    return false;\n  }\n\n  remove_self(){\n    if(this.has_component('Actor') || this.has_component('PlayerActor'))\n      game.scheduler.remove(this);\n\n    game.remove_entity(this);\n  }\n}\n\n/*\n* REACT STUFF\n*/\n\nconst PlayerInfo = props => {\n  var lvl = props.player ? props.player.level : 0;\n  var hp = props.player ? props.player.hp : 0;\n  var atk = props.player ? props.player.attack_value : 0;\n  var def = props.player ? props.player.defense_value : 0;\n  var xp = props.player ? props.player.xp : 0;\n  var flr = props.floor ? props.floor : 0;\n  return (\n    <div className=\"player-info\">\n      <p className='inline'>Level: {lvl}</p>\n      <p className=\"inline\">HP: {hp}</p>\n      <p className=\"inline\">Attack: {atk}</p>\n      <p className=\"inline\">Defense: {def}</p>\n      <p className=\"inline\">XP: {xp}</p>\n      <p className=\"inline\">Floor: {flr}</p>\n    </div>\n  );\n};\n\nclass App extends React.Component{\n  constructor(){\n    super();\n    this.state = {\n      game: game,\n    };\n  }\n\n  // componentWillMount(){\n  //\n  // }\n\n  componentDidMount(){\n    this.state.game.init();\n\n    var handle_render = this.handle_render.bind(this);\n    this.state.game.after_render_callback(handle_render);\n\n    var handle_input = this.handle_input.bind(this);\n    window.addEventListener('keydown', handle_input);\n\n    this.state.game.generate_map();\n\n    //create character\n    this.state.game.create_player();\n\n    var x,y;\n    for(var i = 0; i < 10; i++){\n      [x,y] = this.state.game.get_safe_location();\n      new Entity(x,y, 'Goblin', Templates.Goblin);\n    }\n\n    for(var i = 0; i < 3; i++){\n      [x,y] = this.state.game.get_safe_location();\n      new Entity(x,y, 'Potion', Templates.HealingPotion);\n    }\n\n    [x,y] = this.state.game.get_safe_location();\n    new Entity(x,y, 'Weapon', Templates.Weapon);\n\n    [x,y] = this.state.game.get_safe_location();\n    new Entity(x,y, 'Armor', Templates.Armor);\n\n    [x,y] = this.state.game.get_safe_location();\n    new Entity(x,y, 'Stairs', dynamic_stairs_down());\n\n    // [x,y] = this.state.game.get_safe_location();\n    // new Entity(x,y, 'Goblin King', Templates.GoblinKing);\n\n    this.state.game.engine.start();\n\n    this.state.game.render();\n  }\n\n  handle_input(event){\n    event.preventDefault();\n\n    if(this.state.game.game_over){\n      //restart the game\n      if(event.key === 'Enter'){\n        game.player =  new Entity(0, 0, 'Player', Templates.Player);\n        game.create_new_floor(1);\n        game.game_over = false;\n        game.render();\n        game.Console.clear_buffer();\n        game.Console.init();\n      }\n      //done allow other controls\n      return;\n    }\n\n    //handle movement\n    if(event.key === 'w' || event.key === 'ArrowUp'){\n      //move UP\n      this.move(0, -1);\n    } else if (event.key === 'a' || event.key === 'ArrowLeft'){\n      //upove LEFT\n      this.move(-1,0);\n    } else if (event.key === 's' || event.key === 'ArrowDown'){\n      //move DOWN\n      this.move(0,1);\n    } else if (event.key === 'd' || event.key === 'ArrowRight'){\n      //move RIGHT\n      this.move(1,0);\n    } else if(event.key === 'u'){\n      this.use_at_location();\n    } else if(event.key === 'l'){\n      this.look();\n    }\n    else if (event.key === 'x'){\n      //do nothing\n      this.state.game.engine.unlock();\n    }\n  }\n\n  look(){\n    var entity = this.state.game.get_entity_at(this.state.game.player.x, this.state.game.player.y, this.state.game.player.name);\n    if(entity){\n      create_message('There is a '+entity.name+' here.','#ddd','#000');\n    }else{\n      create_message('There is nothing here.','#ddd', '#000');\n    }\n    this.state.game.engine.unlock();\n  }\n\n  use_at_location(){\n    var entity = this.state.game.get_entity_at(this.state.game.player.x, this.state.game.player.y, this.state.game.player.name);\n\n    if(entity){\n      //console.log(entity);\n      if(entity.name !== this.state.game.player.name)\n        entity.use(this.state.game.player);\n    }\n    this.state.game.engine.unlock();\n  }\n\n  move(dx, dy){\n    this.state.game.player.try_move(this.state.game.player.x+dx, this.state.game.player.y + dy);\n\n    this.state.game.engine.unlock();\n  }\n\n  handle_render(){\n    this.setState({\n      game: game,\n    });\n  }\n\n  render(){\n    return(\n      <div className=\"container\">\n        <div className=\"github\">\n          <a href=\"https://github.com/xevrem/dungeoneer\"><i className=\"fa fa-github\" aria-hidden=\"true\"></i></a>\n        </div>\n        <div className=\"header\">\n          <h1>Dungeoneer: The Roguelike</h1>\n          <PlayerInfo player={this.state.game.player}\n            floor={this.state.game.floor}/>\n        </div>\n        <div id=\"displays\"></div>\n      </div>\n    );\n  }\n}\n\n\nReactDOM.render(<App />, document.getElementById('app'));\nregisterServiceWorker();\n"],"sourceRoot":""}