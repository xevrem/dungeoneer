(this.webpackJsonprogue=this.webpackJsonprogue||[]).push([[0],{18:function(e,t,a){e.exports=a(25)},23:function(e,t,a){},25:function(e,t,a){"use strict";a.r(t);var n=a(4),i=a(2),s=a(5),r=a(11),o=a(6),l=a(0),h=a(1),c=a(8),u=a.n(c),f=a(17),p=a.n(f),d=(a(23),Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/)));function g(e){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var t=e.installing;t.onstatechange=function(){"installed"===t.state&&(navigator.serviceWorker.controller?console.log("New content is available; please refresh."):console.log("Content is cached for offline use."))}}})).catch((function(e){console.error("Error during service worker registration:",e)}))}var m=a(13),y={WALL:["#","#653","#320"],FLOOR:[".","#aaa","#333"],PLAYER:["@","#ddd","#333"],GOBLIN:["g","#5f5","#333"],GOBLIN_KING:["G","#5f5","#333"],HEALING_POTION:["!","#88f","#333"],ARMOR:["a","#ff8","#333"],WEAPON:["w","#875","#333"],STAIRS_DOWN:["v","#ddd","#333"]},_=new(function(){function e(){Object(l.a)(this,e),this.display=null,this.container=null,this.w=50,this.h=30,this.map=[],this.free=[],this.entities=[],this.Console=null,this.console_display=null,this.cw=50,this.ch=5,this.floor=1,this.r=10,this.final_floor=5,this.game_over=!1}return Object(h.a)(e,[{key:"init",value:function(){this.display=new m.a({width:this.w,height:this.h,fontFamily:"Ubuntu Mono",fontSize:15,forceSquareRatio:!0}),this.console_display=new m.a({width:this.cw,height:this.ch,fontFamily:"Ubuntu Mono",fontSize:15,forceSquareRatio:!0}),this.Console=new b(this.console_display,this.ch),this.Console.init(),this.scheduler=new m.e.Simple,this.engine=new m.b(this.scheduler),this.fov=new m.c.PreciseShadowcasting(this.handle_lightpass.bind(this)),this.display_canvas=this.display.getContainer(),this.display_canvas.id="display-canvas",this.console_canvas=this.console_display.getContainer(),this.console_canvas.id="console-canvas",document.getElementById("displays").appendChild(this.display_canvas),document.getElementById("displays").appendChild(this.console_canvas)}},{key:"generate_map",value:function(){new m.d.Uniform(this.w,this.h,{roomWidth:[3,10],roomHeight:[3,10],roomDugPercentage:.3}).create(this.handle_map.bind(this))}},{key:"create_new_floor",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.cleanup(),this.floor=e,this.generate_map();var t=this.get_safe_location(),a=Object(o.a)(t,2),n=a[0],i=a[1];this.player.x=n,this.player.y=i,this.entities.push(this.player),this.scheduler.add(this.player,!0);for(var s=0;s<10;s++){var r=this.get_safe_location(),l=Object(o.a)(r,2);n=l[0],i=l[1],new A(n,i,"Goblin",O(this.floor))}for(s=0;s<3;s++){var h=this.get_safe_location(),c=Object(o.a)(h,2);n=c[0],i=c[1],new A(n,i,"Potion",w.HealingPotion)}var u=this.get_safe_location(),f=Object(o.a)(u,2);n=f[0],i=f[1],new A(n,i,"Weapon",w.Weapon);var p=this.get_safe_location(),d=Object(o.a)(p,2);if(n=d[0],i=d[1],new A(n,i,"Armor",w.Armor),this.floor!==this.final_floor){var g=this.get_safe_location(),m=Object(o.a)(g,2);n=m[0],i=m[1],new A(n,i,"Stairs",x())}if(this.floor===this.final_floor){var y=this.get_safe_location(),_=Object(o.a)(y,2);n=_[0],i=_[1],new A(n,i,"Goblin King",w.GoblinKing)}}},{key:"cleanup",value:function(){var e=!0,t=!1,a=void 0;try{for(var n,i=this.entities[Symbol.iterator]();!(e=(n=i.next()).done);e=!0){var s=n.value;(s.has_component("Actor")||s.has_component("PlayerActor"))&&_.scheduler.remove(s)}}catch(r){t=!0,a=r}finally{try{e||null==i.return||i.return()}finally{if(t)throw a}}this.entities.splice(0,this.entities.length),this.free.splice(0,this.free.length),this.map.splice(0,this.map.length)}},{key:"handle_map",value:function(e,t,a){var n={glyph:a?"WALL":"FLOOR",is_walkable:!a,is_light_passible:!a,uncovered:!1,entities:[]};a||this.free.push([e,t,e*this.h+t]),this.map.push(n)}},{key:"get_safe_location",value:function(){return this.free[Math.floor(Math.random()*this.free.length)]}},{key:"get_tile",value:function(e,t){return e>=0&&e<this.w&&t>=0&&t<this.h?this.map[e*this.h+t]:null}},{key:"get_entity_at",value:function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";if(e>=0&&e<this.w&&t>=0&&t<this.h){var n=!0,i=!1,s=void 0;try{for(var r,o=this.entities[Symbol.iterator]();!(n=(r=o.next()).done);n=!0){var l=r.value;if(l.x===e&&l.y===t&&l.name!==a)return l}}catch(h){i=!0,s=h}finally{try{n||null==o.return||o.return()}finally{if(i)throw s}}}}},{key:"is_entity_adjacent",value:function(e,t,a){for(var n=-1;n<2;n++)for(var i=-1;i<2;i++)if((0!==n||0!==i)&&e+n===a.x&&t+i===a.y)return!0;return!1}},{key:"create_player",value:function(){var e=this.get_safe_location(),t=Object(o.a)(e,2),a=t[0],n=t[1];this.player=new A(a,n,"Player",w.Player)}},{key:"remove_entity",value:function(e){for(var t in this.entities)e===this.entities[t]&&this.entities.splice(t,1)}},{key:"send_message",value:function(e){this.Console.add_message(e)}},{key:"win_game",value:function(){this.game_over=!0,this.cleanup(),this.display.clear(),this.display.drawText(16,12,"%c{gold}Congratulations!!!"),this.display.drawText(8,13,"%c{gold}You Have Defeated The %c{#8f8}Goblin King%c{gold}!"),this.display.drawText(11,15,"To Play Again, Press [ENTER]")}},{key:"lose_game",value:function(e){this.game_over=!0,this.cleanup(),this.display.clear(),this.display.drawText(20,12,"%c{red}You Died!!!");var t="The "+e+" Defeated You.";this.display.drawText(Math.floor(this.w/2)-Math.floor(t.length/2),13,t),this.display.drawText(11,15,"To Play Again, Press [ENTER]")}},{key:"after_render_callback",value:function(e){this.after_render=e}},{key:"handle_lightpass",value:function(e,t){var a=this.get_tile(e,t);return!!a&&a.is_light_passible}},{key:"handle_fov_compute",value:function(e,t,a,n){var i;(i=this.display).draw.apply(i,[e,t].concat(Object(r.a)(y[this.map[e*this.h+t].glyph])));var s,o=this.get_entity_at(e,t,"Player");o&&(s=this.display).draw.apply(s,[o.x,o.y].concat(Object(r.a)(y[o.glyph])))}},{key:"render",value:function(){var e;this.display.clear(),this.fov.compute(this.player.x,this.player.y,this.r,this.handle_fov_compute.bind(this)),(e=this.display).draw.apply(e,[this.player.x,this.player.y].concat(Object(r.a)(y[this.player.glyph]))),this.Console.render(),this.after_render()}},{key:"render_old",value:function(){var e;this.display.clear();for(var t=0;t<this.w;t++)for(var a=0;a<this.h;a++){var n;(n=this.display).draw.apply(n,[t,a].concat(Object(r.a)(y[this.map[t*this.h+a].glyph])))}var i=!0,s=!1,o=void 0;try{for(var l,h=this.entities[Symbol.iterator]();!(i=(l=h.next()).done);i=!0){var c,u=l.value;(c=this.display).draw.apply(c,[u.x,u.y].concat(Object(r.a)(y[u.glyph])))}}catch(f){s=!0,o=f}finally{try{i||null==h.return||h.return()}finally{if(s)throw o}}(e=this.display).draw.apply(e,[this.player.x,this.player.y].concat(Object(r.a)(y[this.player.glyph]))),this.Console.render(),this.after_render()}}]),e}());function v(e,t,a){var n={text:e,fg:t||"#fff",bg:a||"#000"};_.send_message(n)}var b=function(){function e(t,a){Object(l.a)(this,e),this.display=t,this.buffer=[],this.buffer_size=a,this.cursor=0}return Object(h.a)(e,[{key:"init",value:function(){v("Welcome to Dungeoneer: The Roguelike!"),v("Move: [W,A,S,D], Use: [U], Look: [L]"),v("Defeat the Goblin King on floor "+_.final_floor+" to win."),v("You fall through the ground and find yourself","#88f","#000"),v("in a dungeon. There are goblins nearby...","#88f","#000")}},{key:"clear_buffer",value:function(){this.buffer=[],this.cursor=0;for(var e=0;e<this.buffer_size-4;e++)this.buffer.push({text:"",fg:"",bg:""});this.display.clear()}},{key:"add_message",value:function(e){this.buffer[this.cursor%this.buffer_size]=e,this.cursor+=1}},{key:"render",value:function(){this.display.clear();for(var e=0;e<this.buffer_size;e++){var t=(this.cursor+e)%this.buffer_size;this.display.drawText(0,e,"%c{"+this.buffer[t].fg+"}%b{"+this.buffer[t].bg+"}"+this.buffer[t].text)}}}]),e}(),k={};k.Moveable={name:"Moveable",try_move:function(e,t){var a=_.get_tile(e,t),n=_.get_entity_at(e,t);n&&this.has_component("Attacker")&&n.has_component("Destructable")?this.attack(n):a.is_walkable&&(this.x=e,this.y=t)}},k.Actor={name:"Actor",init:function(){this.target=null},act:function(){if(this.target&&_.is_entity_adjacent(this.x,this.y,this.target))this.attack(this.target);else{var e=Math.floor(3*Math.random()-1),t=Math.floor(3*Math.random()-1);if(0!==e||0!==t){var a=this.x+e,n=this.y+t,i=_.get_tile(a,n),s=_.get_entity_at(a,n);if(s&&this.has_component("Attacker")&&s.has_component("Destructable")){if(this.race===s.race)return;return this.target=s,void this.attack(s)}return i.is_walkable?(this.x=a,void(this.y=n)):void 0}}}},k.PlayerActor={name:"PlayerActor",init:function(){},act:function(){_.render(),_.engine.lock()}},k.Attacker={name:"Attacker",init:function(e){this.defense_value=e.defense_value||0,this.attack_value=e.attack_value||1},attack:function(e){if(e.has_component("Destructable")){var t=Math.floor(Math.random()*(1+this.attack_value-e.defense_value));0===t&&v(this.name+" misses "+e.name,"#ff8","#000"),v(this.name+" attacks "+e.name+" for "+t+" damage.","#f80","#000"),e.take_damage(this,t)}}},k.Destructable={name:"Destructable",init:function(e){this.max_hp=e.max_hp||10,this.hp=e.hp||this.max_hp},take_damage:function(e,t){this.hp-=t,this.has_component("Actor")&&(this.target=e),this.hp<=0&&(v(e.name+" kills "+this.name+".","#f55","#000"),this.remove_self(),e.has_component("Leveling")&&e.award(_.floor),this.has_component("WinOnDefeat")&&this.win_game(),this.has_component("LoseOnDefeat")&&this.lose_game(e))}},k.Usable={name:"Usable",init:function(e){this.charges=e.charges||1,this.eternal=e.eternal||!1},use:function(e){this.has_component("Healing")&&(v(e.name+" uses "+this.name+".","#88f","#000"),this.heal(e)),this.has_component("Upgrading")&&(v(e.name+" picks up a "+this.name+".","#ddd","#000"),this.upgrade(e)),this.has_component("ChangesFloor")&&(v(e.name+" uses "+this.name+".","#ddd","#000"),this.change_floor(e)),--this.charges<=0&&(this.eternal||this.remove_self())}},k.Healing={name:"Healing",init:function(e){this.healing_power=e.healing_power||5},heal:function(e){v(e.name+" gains "+this.healing_power+" hp from "+this.name+".","#8f8","#000");var t=e.hp+this.healing_power;e.hp=t>e.max_hp?e.max_hp:t}},k.Upgrading={name:"Upgrading",init:function(e){this.upgrades=e.upgrades||{HP:1}},upgrade:function(e){for(var t in this.upgrades){switch(t){case"HP":e.max_hp+=this.upgrades.HP;break;case"ATK":e.attack_value+=this.upgrades.ATK;break;case"DEF":e.defense_value+=this.upgrades.DEF}v(e.name+" gains "+this.upgrades[t]+" "+t+".","#f8f","#000")}}},k.Leveling={name:"Leveling",init:function(e){this.level=e.level||1,this.xp=e.starting_xp||0,this.next_lvl=e.next_lvl||5},award:function(e){this.xp+=e,v(this.name+" gains experience.","#88f","#000"),this.xp>=this.next_lvl&&(this.level+=1,this.attack_value+=1,this.max_hp+=5,this.hp=this.max_hp,this.next_lvl*=2,v(this.name+" levels up.","#f8f","#000"))}},k.ChangesFloor={name:"ChangesFloor",init:function(e){this.next_floor=e.next_floor||2},change_floor:function(e){v(e.name+" decends deeper into the dungeon.","#ddd","#000"),_.create_new_floor(_.floor+1)}},k.WinOnDefeat={name:"WinOnDefeat",win_game:function(){v("You Have Won!","gold","#000"),_.Console.render(),_.win_game()}},k.LoseOnDefeat={name:"LoseOnDefeat",lose_game:function(e){v("You Have Lost!","red","#000"),_.Console.render(),_.lose_game(e.name)}};var w={};w.Player={glyph:"PLAYER",race:"HUMAN",max_hp:10,attack_value:2,defense_value:0,components:[k.Moveable,k.PlayerActor,k.Attacker,k.Destructable,k.Leveling,k.LoseOnDefeat]},w.Goblin={glyph:"GOBLIN",race:"GOBLIN",max_hp:3,attack_value:2,defense_value:0,components:[k.Moveable,k.Actor,k.Attacker,k.Destructable]},w.HealingPotion={glyph:"HEALING_POTION",healing_power:5,charges:1,components:[k.Usable,k.Healing]},w.Weapon={glyph:"WEAPON",charges:1,upgrades:{ATK:1},components:[k.Usable,k.Upgrading]},w.Armor={glyph:"ARMOR",charges:1,upgrades:{DEF:1},components:[k.Usable,k.Upgrading]},w.GoblinKing={glyph:"GOBLIN_KING",race:"GOBLIN",max_hp:40,attack_value:10,defense_value:5,components:[k.Moveable,k.Actor,k.Attacker,k.Destructable,k.WinOnDefeat]};var O=function(e){return{glyph:"GOBLIN",race:"GOBLIN",max_hp:5+2*e,attack_value:1+e,defense_value:e-1,components:[k.Moveable,k.Actor,k.Attacker,k.Destructable]}},x=function(e){return{glyph:"STAIRS_DOWN",next_floor:e+1,eternal:!0,components:[k.Usable,k.ChangesFloor]}},A=function(){function e(t,a,n,i){Object(l.a)(this,e),this.x=t,this.y=a,this.name=n,this.apply_template(i),_.entities.push(this),(this.has_component("Actor")||this.has_component("PlayerActor"))&&_.scheduler.add(this,!0)}return Object(h.a)(e,[{key:"apply_template",value:function(e){for(var t in e)"components"===t&&this.add_components(e[t],e),this[t]=e[t];return e}},{key:"add_components",value:function(e,t){for(var a in e){for(var n in e[a])"init"===n||"name"===n||this.hasOwnProperty(n)||(this[n]=e[a][n]);e[a].init&&e[a].init.call(this,t)}}},{key:"has_component",value:function(e){var t=!0,a=!1,n=void 0;try{for(var i,s=this.components[Symbol.iterator]();!(t=(i=s.next()).done);t=!0){if(i.value.name===e)return!0}}catch(r){a=!0,n=r}finally{try{t||null==s.return||s.return()}finally{if(a)throw n}}return!1}},{key:"remove_self",value:function(){(this.has_component("Actor")||this.has_component("PlayerActor"))&&_.scheduler.remove(this),_.remove_entity(this)}}]),e}(),E=function(e){var t=e.player?e.player.level:0,a=e.player?e.player.hp:0,n=e.player?e.player.attack_value:0,i=e.player?e.player.defense_value:0,s=e.player?e.player.xp:0,r=e.floor?e.floor:0;return u.a.createElement("div",{className:"player-info"},u.a.createElement("p",{className:"inline"},"Level: ",t),u.a.createElement("p",{className:"inline"},"HP: ",a),u.a.createElement("p",{className:"inline"},"Attack: ",n),u.a.createElement("p",{className:"inline"},"Defense: ",i),u.a.createElement("p",{className:"inline"},"XP: ",s),u.a.createElement("p",{className:"inline"},"Floor: ",r))},P=function(e){function t(){var e;return Object(l.a)(this,t),(e=Object(n.a)(this,Object(i.a)(t).call(this))).state={game:_},e}return Object(s.a)(t,e),Object(h.a)(t,[{key:"componentDidMount",value:function(){this.state.game.init();var e=this.handle_render.bind(this);this.state.game.after_render_callback(e);var t,a,n=this.handle_input.bind(this);window.addEventListener("keydown",n),this.state.game.generate_map(),this.state.game.create_player();for(var i=0;i<10;i++){var s=this.state.game.get_safe_location(),r=Object(o.a)(s,2);t=r[0],a=r[1],new A(t,a,"Goblin",w.Goblin)}for(i=0;i<3;i++){var l=this.state.game.get_safe_location(),h=Object(o.a)(l,2);t=h[0],a=h[1],new A(t,a,"Potion",w.HealingPotion)}var c=this.state.game.get_safe_location(),u=Object(o.a)(c,2);t=u[0],a=u[1],new A(t,a,"Weapon",w.Weapon);var f=this.state.game.get_safe_location(),p=Object(o.a)(f,2);t=p[0],a=p[1],new A(t,a,"Armor",w.Armor);var d=this.state.game.get_safe_location(),g=Object(o.a)(d,2);t=g[0],a=g[1],new A(t,a,"Stairs",x()),this.state.game.engine.start(),this.state.game.render()}},{key:"handle_input",value:function(e){e.preventDefault(),this.state.game.game_over?"Enter"===e.key&&(_.player=new A(0,0,"Player",w.Player),_.create_new_floor(1),_.game_over=!1,_.render(),_.Console.clear_buffer(),_.Console.init()):"w"===e.key||"ArrowUp"===e.key?this.move(0,-1):"a"===e.key||"ArrowLeft"===e.key?this.move(-1,0):"s"===e.key||"ArrowDown"===e.key?this.move(0,1):"d"===e.key||"ArrowRight"===e.key?this.move(1,0):"u"===e.key?this.use_at_location():"l"===e.key?this.look():"x"===e.key&&this.state.game.engine.unlock()}},{key:"look",value:function(){var e=this.state.game.get_entity_at(this.state.game.player.x,this.state.game.player.y,this.state.game.player.name);v(e?"There is a "+e.name+" here.":"There is nothing here.","#ddd","#000"),this.state.game.engine.unlock()}},{key:"use_at_location",value:function(){var e=this.state.game.get_entity_at(this.state.game.player.x,this.state.game.player.y,this.state.game.player.name);e&&e.name!==this.state.game.player.name&&e.use(this.state.game.player),this.state.game.engine.unlock()}},{key:"move",value:function(e,t){this.state.game.player.try_move(this.state.game.player.x+e,this.state.game.player.y+t),this.state.game.engine.unlock()}},{key:"handle_render",value:function(){this.setState({game:_})}},{key:"render",value:function(){return u.a.createElement("div",{className:"container"},u.a.createElement("div",{className:"github"},u.a.createElement("a",{href:"https://github.com/xevrem/dungeoneer"},u.a.createElement("i",{className:"fa fa-github","aria-hidden":"true"}))),u.a.createElement("div",{className:"header"},u.a.createElement("h1",null,"Dungeoneer: The Roguelike"),u.a.createElement(E,{player:this.state.game.player,floor:this.state.game.floor})),u.a.createElement("div",{id:"displays"}))}}]),t}(u.a.Component);p.a.render(u.a.createElement(P,null),document.getElementById("app")),function(){if("serviceWorker"in navigator){if(new URL("/dungeoneer",window.location).origin!==window.location.origin)return;window.addEventListener("load",(function(){var e="".concat("/dungeoneer","/service-worker.js");d?function(e){fetch(e).then((function(t){404===t.status||-1===t.headers.get("content-type").indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):g(e)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(e):g(e)}))}}()}},[[18,1,2]]]);
//# sourceMappingURL=main.c5c9b3ad.chunk.js.map